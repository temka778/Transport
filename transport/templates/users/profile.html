{% extends 'base.html' %}
{% load static %}
{% block title %}ННК - Личный кабинет{% endblock %}
{% block content %}
  <h1>Личный кабинет</h1>
  {% if user.photo %}
    <img src="{{ user.photo.url }}" alt="Фото профиля" class="img-fluid rounded-circle mb-3" width="150">
  {% else %}
    <p>Фото Вашего профиля пока что не загружено.</p>
  {% endif %}
  <p><strong>Имя:</strong> {{ user.first_name }}</p>
  <p><strong>Фамилия:</strong> {{ user.last_name }}</p>
  <p><strong>Электронная почта:</strong> {{ user.email }}</p>
  <p><strong>Телефон:</strong> {{ user.phone_number }}</p>
  {% if orders %}
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Техника</th>
          <th>Дата начала аренды</th>
          <th>Дата окончания аренды</th>
          <th>Статус</th>
          <th>Общая стоимость</th>
          <th>Удалить</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>
            <a href="{{ order.technique.get_absolute_url }}">
              <img src="{{ order.technique.image.url }}" alt="{{ order.technique.name }}" class="img-thumbnail" width="70">
            </a>
          </td>
          <td>{{ order.technique.name }}</td>
          <td>{{ order.start_date }}</td>
          <td>{{ order.end_date }}</td>
          <td>{{ order.get_status_display }}</td>
          <td>{{ order.total_cost }} ₽</td>
          <td>
              <button type="submit" class="btn btn-link p-0" style="color:red;" style="color:red;" data-toggle="modal" data-target="#confirmDeleteModal{{ order.id }}">
                <img src="{% static 'img/free-icon-delete.png' %}" alt="Удалить" width="20">
              </button>
            </form>
            <!-- Модальное окно для подтверждения удаления -->
            <div class="modal fade" id="confirmDeleteModal{{ order.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-body">
                    Вы уверены, что хотите удалить заказ?
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    <form action="{% url 'orders:delete_order' order.id %}" method="POST">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger">Да</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>У вас пока нет заказов.</p>
  {% endif %}
  <a href="{% url 'profile_update' %}" class="btn btn-dark text-white mt-3">Управление профилем</a>
{% endblock %}
{% block extra_js %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}